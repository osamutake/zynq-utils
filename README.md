zynq-utils - zynq development utilities
==========

Utilities for zynq development.

License
-------
The MIT License

https://opensource.org/licenses/MIT

Reference
---------
* [電気回路/zynq - 武内＠筑波大 #kc37dfd8](https://dora.bk.tsukuba.ac.jp/~takeuchi/?%E9%9B%BB%E6%B0%97%E5%9B%9E%E8%B7%AF%2Fzynq#kc37dfd8)

Contents
--------
* [fpga-program](#fpga-program) - Program FPGA programmable logic using Fpga Region
* [fpga](#fpga) - A init.d script that initializes and finalizes fpga
* [dto](#dto) - Device Tree Overlay utility
* [uio](#uio) - A program to manipulate uio devices
* [flip32](#flip32) - Flip byte order of 32bit word data
* [lcd-control](#lcd-control) - Manipulate character LCD controller ST7032i via i2c



<hr>

<span id="fpga-program">fpga-program</span> - Program FPGA programmable logic using Fpga Region
============

What is this?
-------------

This is a script to program the programmable logic of FPGA by using Fpga Region technique.

It accepts a **little-endian** `.bin` file that is generated by Xilinx vivado.

Usage
-------

Show usage:
```console
$ fpga-program
USAGE: fpga-program little-endian.bin
```

Program FPGA:
```console
$ fpga-program little-endian.bin
```

NOTE: This script automatically convert the given **little-endian** `.bin`
file to **big-endian** format and program FPGA by using the converted `.bin` file.
So, DO NOT give a **big-endian** `.bin` file to this script.

Reference
---------
* [電気回路/zynq/Petalinux2018.3でPLとDevice Treeを動的に変更する - 武内＠筑波大 #gb07ac62](https://dora.bk.tsukuba.ac.jp/~takeuchi/?%E9%9B%BB%E6%B0%97%E5%9B%9E%E8%B7%AF%2Fzynq%2FPetalinux2018.3%E3%81%A7PL%E3%81%A8Device%20Tree%E3%82%92%E5%8B%95%E7%9A%84%E3%81%AB%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B#gb07ac62)

<hr>

<span id="fpga">fpga</span> - A init.d script that initializes and finalizes fpga
==========================================================

What is this?
-------------

This is an init.d script that is  to initialize and to finalize fpga.

It will:
- program FPGA programmable logic with using `/boot/design*.bin`
- setup device tree by overlaying  `/boot/dtso/*.dtso`
- invoke init.d files `/boot/fpga_init.d/*`

Install
-------

Place **little-endian** formatted *.bin* file at `/boot` like `/boot/design_1_wrapper.bin`.
Thie file name must be matched by the wild card `/boot/design*.bin`.

Place device tree source fragmen for device tree overlay as `/boot/dtso/*.dtso*`.
The files will be processed in the alphabetical order at `start` and in the opposite order at `stop`.

Place `init.d` type scripts at `/boot/fpga_init.d/` to be processed.
The files will be processed in the alphabetical order at `start` and in the opposite order at `stop`.

Copy the script `fpga` into `/etc/init.d/` and setup auto start at boot time with creating a symbolic links in `/etc/rc?.d/` by `update-rc.d`.

Reference
---------
* [電気回路/zynq/自動起動の設定 - 武内＠筑波大 #rfb55e43](https://dora.bk.tsukuba.ac.jp/~takeuchi/?%E9%9B%BB%E6%B0%97%E5%9B%9E%E8%B7%AF%2Fzynq%2F%E8%87%AA%E5%8B%95%E8%B5%B7%E5%8B%95%E3%81%AE%E8%A8%AD%E5%AE%9A#rfb55e43)

<hr>

<span id="dto">dto</span> - Device Tree Overlay utility
=====================

What is this?
----------

This small script helps you to modify your device tree without reboot based on the device tree overlay technology.

Usage
----------

Show usage:
```console
$ dto
USAGE: sudo dto folder-name [file-name.dts]
```

Compile device tree source fragment file 'overlay.dtso' and 
load the result onto
`/sys/kernel/config/device-tree/overlays/overlay-path/dtbo`
to overlay the device tree:
```console
$ dto overlay-path overlay.dtso
```

Unapply the overlayed dtbo at 
`/sys/kernel/config/device-tree/overlays/overlay-path/dtbo`:
```console
$ dto overlay-path
```


Example
----------

```console
$ cat << EOT > example.dtso
/dts-v1/;
/plugin/;
/ {
  fragment@0 {
    target-path = "/some-device";
    __overlay__ {
      property1;
      property2 = "value";
      property3 = <1 2 3>;
      some : some@1234 {
        property1;
        property2 = "value";
        property3 = <1 2 3>;
      }
    };
  };
};
EOT

$ ls /sys/kernel/config/device-tree/overlays/example
ls: cannot access '/sys/kernel/config/device-tree/overlays/example': No such file or directory

$ dto example example.dtso  # apply 'example.dtso' to the device tree

$ ls /sys/kernel/config/device-tree/overlays/example
dtbo  path  status

$ cat /sys/kernel/config/device-tree/overlays/gpio1/status
applied

$ dto example   # unapply 'example.dtso'

$ ls /sys/kernel/config/device-tree/overlays/example
ls: cannot access '/sys/kernel/config/device-tree/overlays/example': No such file or directory
```

Reference
---------
* [電気回路/zynq/Petalinux2018.3でPLとDevice Treeを動的に変更する - 武内＠筑波大 #b87fd39f](https://dora.bk.tsukuba.ac.jp/~takeuchi/?%E9%9B%BB%E6%B0%97%E5%9B%9E%E8%B7%AF%2Fzynq%2FPetalinux2018.3%E3%81%A7PL%E3%81%A8Device%20Tree%E3%82%92%E5%8B%95%E7%9A%84%E3%81%AB%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B#b87fd39f)

<hr>

<span id="uio">uio</span> - A program to manipulate uio devices
=========================================

What is this?
-------------

This program allows you to manipulate `/dev/uio?` devices.

Usage
-------

Show usage:
```console
$ uio
USAGE: uio uio_num byte_offset [value]
```

Read a long word at byte ofset of `8` of the `/dev/uio0`.
```console
$ uio 0 8
0x0000001
```

Write a long word value `100` at byte ofset of `8` of the `/dev/uio0`.
```console
$ uio 0 8 100

$ # hexadecimal format is also accepted
$ uio 0 8 0x00000064
```

Reference
----------
* [電気回路/zynq/Petalinux2018.3でaxi_gpio - 武内＠筑波大 #ma01034d](https://dora.bk.tsukuba.ac.jp/~takeuchi/?%E9%9B%BB%E6%B0%97%E5%9B%9E%E8%B7%AF%2Fzynq%2FPetalinux2018.3%E3%81%A7axi_gpio#ma01034d)

<hr>

<span id="flip32">flip32</span> - Flip byte order of 32bit word data
============================

What is this?
--------------

A small utility that flip the byte order of all 32bit values in a file.

Usage
-------

```console
$ flip32 input.file > output.file
```

Whay is this needed?
------------------------

Xilinx fpga region technology allows us to program the FPGA programable logic without reboot.
However, it requires a **big-endian** binary file to be programmed into a FPGA.

On the other hand, Xilinx vivado generates **little-endian** binary file that can not be used by fpga region process.

``flip32`` converts the **little-endian** bin file to a **big-endian** bin file to fill the gap.

```console
$ flip32 little-endian.bin > big-endian.bin
```

Reference
---------
* [電気回路/zynq/Petalinux2018.3でPLとDevice Treeを動的に変更する - 武内＠筑波大 #zb2c4ddb](https://dora.bk.tsukuba.ac.jp/~takeuchi/?%E9%9B%BB%E6%B0%97%E5%9B%9E%E8%B7%AF%2Fzynq%2FPetalinux2018.3%E3%81%A7PL%E3%81%A8Device%20Tree%E3%82%92%E5%8B%95%E7%9A%84%E3%81%AB%E5%A4%89%E6%9B%B4%E3%81%99%E3%82%8B#zb2c4ddb)

<hr>

<span id="lcd-control">lcd-control</span> - Manipulate character LCD controller ST7032i via i2c
===========

What is this?
-------------

This program allows you to send commands to the popular LCD controller ST7032i via i2c.

Condition
-----------

This program assumes the ST7032i controller is connected to `/dev/i2c-1`.

If it is connected to some other device, you need to change the parameter and recompile the program.

Usage
-------

Show usage:
```console
$ lcd-control
USAGE:
lcd-control "Hello!"
lcd-control -c 0x39 0x14 0x78 ...
```

Send command characters:
```console
$ # initialization
$ lcd-control -c 0x38
$ lcd-control -c 0x39
$ lcd-control -c 0x14 0x7c 0x5d 0x6d 0x0c 0x06 0x01

$ # clear screen
$ lcd-control -c 0x01

$ # move to the top of the second line
$ lcd-control -c 0xc0 
```

Send printable characters:
```console
$ lcd-control "Hello, world!"
```

Reference
----------
* [電気回路/zynq/Petalinux2018.3でキャラクタLCD制御(ST7032i) - 武内＠筑波大](https://dora.bk.tsukuba.ac.jp/~takeuchi/?%E9%9B%BB%E6%B0%97%E5%9B%9E%E8%B7%AF%2Fzynq%2FPetalinux2018.3%E3%81%A7%E3%82%AD%E3%83%A3%E3%83%A9%E3%82%AF%E3%82%BFLCD%E5%88%B6%E5%BE%A1%28ST7032i%29)

